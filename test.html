<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Join Draft</title>
  </head>
  <style>
    #joinDraftForm {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      max-width: 28rem;
    }
    #joinDraftForm input[type='text'] {
      width: 100%;
      padding: 0.5rem 0.75rem;
      font-size: 1rem;
      box-sizing: border-box;
    }
  </style>
  <body>
    <div id="root">
      <p>
        Users: mubsy, johnor, aliC01112002, clez, Rartaz, johnyb0223, kmoen98, daviskar,
        elciddawg14, OwayneOwens
      </p>
      <p>
        Players: Ja&#39;Marr Chase, Saquon Barkley, Bijan Robinson, Josh Allen, Jahmyr Gibbs, Justin
        Jefferson, Lamar Jackson, Amon-Ra St. Brown, CeeDee Lamb, Puka Nacua, Derrick Henry, Malik
        Nabers, Christian McCaffrey, Jayden Daniels, Ashton Jeanty, Joe Burrow, Brian Thomas,
        De&#39;Von Achane, Nico Collins, Jalen Hurts, Josh Jacobs, Brock Bowers, Drake London, Bucky
        Irving, Jonathan Taylor, A.J. Brown, Travis Hunter, Ladd McConkey, Trey McBride, Kyren
        Williams, Jaxon Smith-Njigba, Patrick Mahomes, Chase Brown, Todd Gurley, Tyreek Hill, James
        Cook, Tee Higgins, Marvin Harrison, Omarion Hampton, Garrett Wilson, Breece Hall, Terry
        McLaurin, Mike Evans, George Kittle, Bo Nix, Alvin Kamara, Sam LaPorta, TreVeyon Henderson,
        Rashee Rice, Kenneth Walker, Davante Adams, Tetairoa McMillan, Chuba Hubbard, DK Metcalf,
        James Conner, Joe Mixon, DJ Moore, C.J. Stroud, Courtland Sutton, Baker Mayfield, David
        Montgomery, Zay Flowers, DeVonta Smith, RJ Harvey, Justin Herbert, Quinshon Judkins, Xavier
        Worthy, Jameson Williams, T.J. Hockenson, Isiah Pacheco, George Pickens, Rome Odunze, Travis
        Kelce, Tyler Warren, Kaleb Johnson, Aaron Jones, Caleb Williams, D&#39;Andre Swift, Tony
        Pollard, Jaylen Waddle, Drake Maye, Chris Olave, Jordan Addison, Chris Godwin, Jerry Jeudy,
        Calvin Ridley, Tom Brady, Mark Andrews, Kyler Murray, Drew Brees, Evan Engram, Brock Purdy,
        Jordan Love, Tyrone Tracy, Brian Robinson, Jakobi Meyers, Deebo Samuel, Colston Loveland,
        Khalil Shakir, David Njoku, Emeka Egbuka, Stefon Diggs, Travis Etienne, Cooper Kupp, Jonnu
        Smith, Jared Goff, Jaylen Warren, Antonio Brown, Najee Harris, Ricky Pearsall, Matthew
        Golden, Julian Edelman, Brandon Aiyuk, J.J. McCarthy, Jayden Reed, Cam Skattebo, Cam Ward,
        Jordan Mason, Javonte Williams, Jauan Jennings, Dak Prescott, Zach Charbonnet, J.K. Dobbins,
        Gus Edwards, Dalton Kincaid, Josh Downs, Rhamondre Stevenson, Tucker Kraft, Darnell Mooney,
        Ezekiel Elliott, Michael Pittman, Tyjae Spears, Kyle Pitts, Keon Coleman, Jayden Higgins,
        Rob Gronkowski, Tank Bigsby, William Fuller, Jake Ferguson, Austin Ekeler, Justin Fields,
        Henry Ruggs, Damien Harris, Rachaad White, Dallas Goedert, Bryce Love, Nick Chubb, Rashid
        Shaheed, Tre&#39; Harris, Jaydon Blue, Luther Burden, Marvin Mims, Rico Dowdle, Jacory
        Croskey-Merritt, Bhayshul Tuten, Christian Kirk, Jalen McMillan, Kyle Williams, Isaac
        Guerendo, Trevor Lawrence, Ray Davis, Jack Bech, Trey Benson, Braelon Allen, Rashod Bateman,
        Hollywood Brown, Philip Rivers, Zach Ertz, Jerome Ford, Keenan Allen, Tyler Allgeier, Isaiah
        Likely, Hunter Henry, Bryce Young, Michael Penix, Pat Freiermuth, Tua Tagovailoa, Matthew
        Stafford, Adam Thielen, Alshon Jeffery, Dylan Sampson, Mike Gesicki, Mason Taylor, Larry
        Fitzgerald, Quentin Johnston, Jaylen Wright, Blake Corum, Cedric Tillman, Roschon Johnson,
        Cade Otton, Brenton Strange, Wan&#39;Dale Robinson, Ben Roethlisberger, Xavier Legette,
        DeAndre Hopkins, Joshua Palmer, Dont&#39;e Thornton, Geno Smith, Romeo Doubs, Ollie Gordon,
        Anthony Richardson, Amari Cooper, Devin Neal, Brashard Smith, Sam Darnold, Frank Gore,
        Kareem Hunt, Aaron Rodgers, Alec Pierce, DeMario Douglas, Pat Bryant, Justice Hill, Dalton
        Schultz, MarShawn Lloyd, Terrance Ferguson, Woody Marks, Chig Okonkwo, Kyle Monangai, DJ
        Giddens, Tyrell Williams, Jaylin Noel, Will Shipley, Jalen Royals, Jordan James, Chris
        Carson, Mike Davis, Jaxson Dart, Derek Carr, Gabe Davis, Michael Wilson, Darren Waller,
        Ja&#39;Tavion Sanders, Tyler Lockett, Shedeur Sanders, Elijah Arroyo, Russell Wilson,
        Jarquez Hunter, Adonai Mitchell, Cole Kmet, Ted Ginn, Isaac TeSlaa, Jaleel McLaughlin,
        Keaton Mitchell, Elic Ayomanor, Dontrelle Inman, Jarvis Landry, Dontayvion Wicks, Juwan
        Johnson, Theo Johnson, Eric Ebron, A.J. Green, Blake Jarwin, LeSean McCoy, Cam Newton, Kenny
        Golladay, Michael Thomas, Mark Ingram, Titus Swen, J.D. McKissic, Tyler Shough, Miles
        Sanders, Leonard Fournette, Le&#39;Veon Bell, Jerick McKinnon, Daniel Jones, Tory Horton,
        Jalen Coker, Tahj Brooks, Harold Fannin, Dyami Brown, Raheem Mostert, Calvin Austin, Dion
        Lewis, Trevor Etienne, Darius Slayton, Tyler Boyd, D&#39;Onta Foreman, Troy Franklin, Kendre
        Miller, Roman Wilson, Odell Beckham, Noah Gray, Jalen Milroe, Xavier Restrepo, Tanner Morgan
      </p>
    </div>
    <form id="joinDraftForm">
      <input
        type="text"
        id="sleeperUsername"
        name="sleeperUsername"
        placeholder="Enter Sleeper username to join draft."
        title="Enter Sleeper username to join draft."
        autocomplete="username"
        required
      />
      <input
        type="text"
        id="draftPassword"
        name="draftPassword"
        placeholder="Make up a draft password or, if you're re-joining, use your existing password."
        title="Make up a draft password or, if you're re-joining, use your existing password."
        autocomplete="current-password"
        required
      />
      <button type="submit">Join Draft</button>
    </form>
    <script type="module">
      import { initializeApp } from 'https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js';
      import { getAnalytics } from 'https://www.gstatic.com/firebasejs/12.1.0/firebase-analytics.js';
      import {
        getFirestore,
        doc,
        onSnapshot,
      } from 'https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js';
      import {
        getAuth,
        signInWithCustomToken,
        indexedDBLocalPersistence,
        setPersistence,
      } from 'https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js';
      const firebaseConfig = {
        apiKey: 'AIzaSyBF7ONgQ0LCYGcf2pRpcUSjH4eaKDSNkwE',
        authDomain: 'test-vickrey.firebaseapp.com',
        projectId: 'test-vickrey',
        storageBucket: 'test-vickrey.firebasestorage.app',
        messagingSenderId: '373721638486',
        appId: '1:373721638486:web:1884aeaf06132f1047fdf7',
        measurementId: 'G-LGCLMMK0EJ',
      };
      const app = initializeApp(firebaseConfig);
      getAnalytics(app);
      const auth = getAuth(app);
      setPersistence(auth, indexedDBLocalPersistence);
      const db = getFirestore(app);
      const mainDocRef = doc(
        db,
        'drafts',
        '0776cbd3-2e23-4911-99c1-f065a7cb052e',
        'pages',
        'public'
      );
      const localRoot = document.getElementById('root');
      onSnapshot(mainDocRef, (snap) => {
        const html = snap.data()?.html ?? '<h1>No HTML found</h1>';
        const remoteRoot = new DOMParser()
          .parseFromString(html, 'text/html')
          .getElementById('root');
        if (localRoot && remoteRoot) localRoot.innerHTML = remoteRoot.innerHTML;
      });
      const form = document.getElementById('joinDraftForm');
      form.addEventListener('submit', joinDraft);
      async function joinDraft(event) {
        event.preventDefault();
        const username = event.target.sleeperUsername.value.trim();
        const password = event.target.draftPassword.value;
        try {
          const res = await fetch('https://vickrey-registration-373721638486.us-east1.run.app/', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, password }),
          });
          if (res.status === 404) {
            alert('Team name not found');
          } else if (res.status === 401) {
            alert('Invalid password');
          } else if (!res.ok) {
            const text = await res.text();
            throw new Error(text || 'Request failed with status ' + res.status);
          } else {
            const token_response = await res.json();
            await signInWithCustomToken(auth, token_response.token);
            const teamPageRef = doc(
              db,
              'drafts',
              '0776cbd3-2e23-4911-99c1-f065a7cb052e',
              'pages',
              username
            );
            onSnapshot(teamPageRef, (snap) => {
              const data = snap.data();
              const html = data?.html ?? '<h1>No HTML found</h1>';
              document.open();
              document.write(html);
              document.close();
            });
          }
        } catch (err) {
          console.error(err);
          alert('There was a problem joining the draft. See console for details.');
        }
      }
    </script>
  </body>
</html>
