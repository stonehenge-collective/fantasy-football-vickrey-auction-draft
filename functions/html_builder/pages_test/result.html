<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Join Draft</title>
<style>
#joinDraftForm{display:flex;flex-direction:column;gap:.75rem;max-width:28rem}
#joinDraftForm input[type='text']{width:100%;padding:.5rem .75rem;font-size:1rem;box-sizing:border-box}
</style>
</head>
<body>
<div id="root">
<h1>Join Draft</h1><p>Users: mubsy, johnor, aliC01112002, clez, Rartaz, johnyb0223, kmoen98, daviskar, elciddawg14, OwayneOwens</p><p>Players: Ja&#39;Marr Chase, Saquon Barkley, Josh Allen, Bijan Robinson, Jahmyr Gibbs, Justin Jefferson, Lamar Jackson, CeeDee Lamb, Amon-Ra St. Brown, Derrick Henry, Puka Nacua, Malik Nabers, Christian McCaffrey, Jayden Daniels, Ashton Jeanty, Joe Burrow, Nico Collins, De&#39;Von Achane, Brian Thomas, Josh Jacobs, Jalen Hurts, Brock Bowers, Drake London, Bucky Irving, Jonathan Taylor, Travis Hunter, A.J. Brown, Ladd McConkey, Trey McBride, Kyren Williams, Jaxon Smith-Njigba, Patrick Mahomes, Chase Brown, Tyreek Hill, Todd Gurley, James Cook, Tee Higgins, Garrett Wilson, Omarion Hampton, Marvin Harrison, Breece Hall, Terry McLaurin, George Kittle, Mike Evans, Bo Nix, Alvin Kamara, TreVeyon Henderson, Sam LaPorta, Kenneth Walker, Rashee Rice, Davante Adams, Tetairoa McMillan, Chuba Hubbard, DK Metcalf, Joe Mixon, James Conner, DJ Moore, C.J. Stroud, Courtland Sutton, Baker Mayfield, David Montgomery, Zay Flowers, DeVonta Smith, RJ Harvey, Justin Herbert, Quinshon Judkins, Xavier Worthy, Jameson Williams, Isiah Pacheco, T.J. Hockenson, George Pickens, Travis Kelce, Rome Odunze, Tyler Warren, D&#39;Andre Swift, Kaleb Johnson, Aaron Jones, Caleb Williams, Tony Pollard, Drake Maye, Jaylen Waddle, Chris Olave, Jordan Addison, Jerry Jeudy, Calvin Ridley, Chris Godwin, Mark Andrews, Tom Brady, Drew Brees, Kyler Murray, Brock Purdy, Evan Engram, Jordan Love, Brian Robinson, Tyrone Tracy, Deebo Samuel, Jakobi Meyers, Colston Loveland, David Njoku, Khalil Shakir, Stefon Diggs, Cooper Kupp, Emeka Egbuka, Travis Etienne, Jonnu Smith, Jaylen Warren, Jared Goff, Antonio Brown, Matthew Golden, Ricky Pearsall, Najee Harris, Julian Edelman, Brandon Aiyuk, J.J. McCarthy, Jayden Reed, Cam Skattebo, Cam Ward, Jordan Mason, Javonte Williams, Jauan Jennings, J.K. Dobbins, Zach Charbonnet, Dak Prescott, Josh Downs, Dalton Kincaid, Gus Edwards, Rhamondre Stevenson, Tucker Kraft, Darnell Mooney, Michael Pittman, Ezekiel Elliott, Tyjae Spears, Kyle Pitts, Keon Coleman, Jayden Higgins, Rob Gronkowski, William Fuller, Tank Bigsby, Jake Ferguson, Austin Ekeler, Justin Fields, Henry Ruggs, Rachaad White, Damien Harris, Dallas Goedert, Bryce Love, Rashid Shaheed, Nick Chubb, Tre&#39; Harris, Jaydon Blue, Luther Burden, Marvin Mims, Rico Dowdle, Jacory Croskey-Merritt, Bhayshul Tuten, Christian Kirk, Jalen McMillan, Kyle Williams, Isaac Guerendo, Ray Davis, Trevor Lawrence, Trey Benson, Jack Bech, Braelon Allen, Rashod Bateman, Philip Rivers, Hollywood Brown, Zach Ertz, Jerome Ford, Tyler Allgeier, Keenan Allen, Isaiah Likely, Bryce Young, Michael Penix, Hunter Henry, Pat Freiermuth, Tua Tagovailoa, Matthew Stafford, Adam Thielen, Alshon Jeffery, Dylan Sampson, Mike Gesicki, Larry Fitzgerald, Mason Taylor, Quentin Johnston, Jaylen Wright, Cedric Tillman, Blake Corum, Roschon Johnson, Brenton Strange, Cade Otton, Wan&#39;Dale Robinson, Ben Roethlisberger, DeAndre Hopkins, Joshua Palmer, Xavier Legette, Dont&#39;e Thornton, Geno Smith, Romeo Doubs, Ollie Gordon, Anthony Richardson, Devin Neal, Amari Cooper, Sam Darnold, Brashard Smith, Frank Gore, Aaron Rodgers, Kareem Hunt, Alec Pierce, DeMario Douglas, Pat Bryant, Dalton Schultz, Justice Hill, MarShawn Lloyd, Terrance Ferguson, Woody Marks, Chig Okonkwo, Kyle Monangai, Tyrell Williams, DJ Giddens, Jaylin Noel, Will Shipley, Jalen Royals, Jordan James, Chris Carson, Derek Carr, Jaxson Dart, Mike Davis, Gabe Davis, Darren Waller, Michael Wilson, Ja&#39;Tavion Sanders, Tyler Lockett, Shedeur Sanders, Jarquez Hunter, Elijah Arroyo, Russell Wilson, Adonai Mitchell, Cole Kmet, Ted Ginn, Jaleel McLaughlin, Isaac TeSlaa, Keaton Mitchell, Jarvis Landry, Elic Ayomanor, Dontayvion Wicks, Dontrelle Inman, Juwan Johnson, Theo Johnson, Eric Ebron, A.J. Green, Blake Jarwin, LeSean McCoy, Cam Newton, Kenny Golladay, Michael Thomas, Mark Ingram, Titus Swen, Miles Sanders, Tyler Shough, J.D. McKissic, Leonard Fournette, Le&#39;Veon Bell, Jerick McKinnon, Jalen Coker, Tahj Brooks, Daniel Jones, Tory Horton, Harold Fannin, Dyami Brown, Calvin Austin, Raheem Mostert, Dion Lewis, Trevor Etienne, Tyler Boyd, Darius Slayton, D&#39;Onta Foreman, Troy Franklin, Kendre Miller, Roman Wilson, Noah Gray, Odell Beckham, Jalen Milroe, Xavier Restrepo, Tanner Morgan</p><form id="joinDraftForm">
<input type="text" id="sleeperUsername" name="sleeperUsername" placeholder="Enter Sleeper username" autocomplete="username" required>
<input type="text" id="draftPassword" name="draftPassword" placeholder="Password" autocomplete="current-password" required>
<button type="submit">Join Draft</button>
</form>
</div>
<script type="module">import { initializeApp } from 'https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js';
import { getAnalytics } from 'https://www.gstatic.com/firebasejs/12.1.0/firebase-analytics.js';
import { getFirestore } from 'https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js';
import {
  getAuth,
  indexedDBLocalPersistence,
  setPersistence,
} from 'https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js';

const firebaseConfig = {
  apiKey: 'AIzaSyBF7ONgQ0LCYGcf2pRpcUSjH4eaKDSNkwE',
  authDomain: 'test-vickrey.firebaseapp.com',
  projectId: 'test-vickrey',
  storageBucket: 'test-vickrey.firebasestorage.app',
  messagingSenderId: '373721638486',
  appId: '1:373721638486:web:1884aeaf06132f1047fdf7',
  measurementId: 'G-LGCLMMK0EJ',
};

const app = initializeApp(firebaseConfig);
getAnalytics(app);
const auth = getAuth(app);
setPersistence(auth, indexedDBLocalPersistence);

const db = getFirestore(app);
import { doc, onSnapshot } from 'https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js';

const mainDocRef = doc(db, 'drafts', '%s', 'pages', 'public');
const localRoot = document.getElementById('root');

onSnapshot(mainDocRef, (snap) => {
  const html = snap.data()?.html ?? '<h1>No HTML found</h1>';
  const remoteRoot = new DOMParser().parseFromString(html, 'text/html').getElementById('root');
  if (localRoot && remoteRoot) localRoot.innerHTML = remoteRoot.innerHTML;
});
</script><script type="module">import { initializeApp } from 'https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js';
import { getAnalytics } from 'https://www.gstatic.com/firebasejs/12.1.0/firebase-analytics.js';
import { getFirestore } from 'https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js';
import {
  getAuth,
  indexedDBLocalPersistence,
  setPersistence,
} from 'https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js';

const firebaseConfig = {
  apiKey: 'AIzaSyBF7ONgQ0LCYGcf2pRpcUSjH4eaKDSNkwE',
  authDomain: 'test-vickrey.firebaseapp.com',
  projectId: 'test-vickrey',
  storageBucket: 'test-vickrey.firebasestorage.app',
  messagingSenderId: '373721638486',
  appId: '1:373721638486:web:1884aeaf06132f1047fdf7',
  measurementId: 'G-LGCLMMK0EJ',
};

const app = initializeApp(firebaseConfig);
getAnalytics(app);
const auth = getAuth(app);
setPersistence(auth, indexedDBLocalPersistence);

const db = getFirestore(app);
import { doc, onSnapshot } from 'https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js';
import { signInWithCustomToken } from 'https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js';

const form = document.getElementById('joinDraftForm');
form.addEventListener('submit', joinDraft);

async function joinDraft(event) {
  event.preventDefault();

  const username = event.target.sleeperUsername.value.trim();
  const password = event.target.draftPassword.value;

  try {
    const res = await fetch('https://vickrey-registration-373721638486.us-east1.run.app/', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ username, password }),
    });

    if (res.status === 404) {
      alert('Team name not found');
    } else if (res.status === 401) {
      alert('Invalid password');
    } else if (!res.ok) {
      const text = await res.text();
      throw new Error(text || 'Request failed with status ' + res.status);
    } else {
      const token_response = await res.json();
      await signInWithCustomToken(auth, token_response.token);
      const teamPageRef = doc(db, 'drafts', '%s', 'pages', username);

      onSnapshot(teamPageRef, (snap) => {
        const data = snap.data();
        const html = data?.html ?? '<h1>No HTML found</h1>';
        document.open();
        document.write(html);
        document.close();
      });
    }
  } catch (err) {
    console.error(err);
    alert('There was a problem joining the draft. See console for details.');
  }
}
</script>
</body>
</html>